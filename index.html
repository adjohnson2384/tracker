<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Iron & Mats Pro</title>
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22Iron%20%26%20Mats%22,%22short_name%22:%22IronMats%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22background_color%22:%22#121212%22,%22theme_color%22:%22#bb86fc%22}">
    <style>
        :root { --bg: #121212; --surface: #1e1e1e; --primary: #bb86fc; --text: #e0e0e0; --accent: #03dac6; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; padding-bottom: 50px; }
        .card { background: var(--surface); padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #333; }
        h2 { color: var(--primary); font-size: 1.2rem; margin-bottom: 10px; }
        input, select, button { width: 100%; padding: 12px; margin: 5px 0; border-radius: 8px; border: none; font-size: 16px; box-sizing: border-box; }
        button { background: var(--primary); color: #000; font-weight: bold; }
        .timer-display { font-size: 3.5rem; text-align: center; margin: 10px 0; font-family: monospace; color: var(--accent); }
        .log-entry { font-size: 0.85rem; color: #aaa; border-bottom: 1px solid #333; padding: 4px 0; display: flex; justify-content: space-between; }
        .weight-input-group { display: flex; gap: 10px; align-items: center; margin-top: 10px; }
        .weight-input-group input { flex: 2; background: #2c2c2c; color: white; border: 1px solid var(--primary); }
        .weight-input-group button { flex: 1; background: var(--accent); }
        .info-tag { font-size: 10px; background: #333; padding: 2px 6px; border-radius: 4px; color: var(--primary); text-transform: uppercase; }
        .history-section { max-height: 100px; overflow-y: auto; margin-top: 10px; background: #161616; padding: 8px; border-radius: 6px; }
    </style>
</head>
<body>

    <div class="card">
        <div id="timer-display" class="timer-display">00:00</div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <button onclick="startTimer(60)">RPE ≤5 (1m)</button>
            <button onclick="startTimer(120)">RPE 6-7 (2m)</button>
            <button onclick="startTimer(180)">RPE 8-9 (3m)</button>
            <button onclick="startTimer(300)">RPE 10 (5m)</button>
        </div>
    </div>

    <h2>Add Exercise</h2>
    <div class="card">
        <input type="text" id="ex-name" placeholder="Exercise Name">
        <select id="ex-prog">
            <option value="Juggernaut">Juggernaut 2.0</option>
            <option value="Hypertrophy">Hypertrophy Progression</option>
        </select>
        <button onclick="addExercise()">Create Exercise</button>
    </div>

    <h2>Your Program</h2>
    <div id="exercise-list"></div>

    <script>
        let exercises = JSON.parse(localStorage.getItem('workout_v2')) || [];
        let timerInterval;

        function save() { localStorage.setItem('workout_v2', JSON.stringify(exercises)); }

        function addExercise() {
            const name = document.getElementById('ex-name').value;
            const prog = document.getElementById('ex-prog').value;
            if(!name) return;
            exercises.push({ id: Date.now(), name, prog, week: 1, logs: [] });
            save(); render();
            document.getElementById('ex-name').value = '';
        }

        function logWeight(id) {
            const input = document.getElementById(`weight-${id}`);
            const weight = input.value;
            if(!weight) return;
            const ex = exercises.find(e => e.id === id);
            const entry = {
                date: new Date().toLocaleDateString(),
                week: ex.week,
                weight: weight
            };
            ex.logs.unshift(entry); // Add to start of array
            save(); render();
            input.value = '';
        }

        function getProgression(ex) {
            if (ex.prog === 'Hypertrophy') {
                const reps = ["10-12", "12-15", "15-18", "18-20"];
                return `Week ${ex.week}: 3 Sets of ${reps[(ex.week-1) % 4]} Reps`;
            } else {
                const waves = ["10s", "8s", "5s", "3s"];
                const phases = ["Accumulation", "Intensification", "Realization", "Deload"];
                const wIdx = Math.floor((ex.week - 1) / 4) % 4;
                const pIdx = (ex.week - 1) % 4;
                return `${waves[wIdx]} Wave: ${phases[pIdx]}`;
            }
        }

        function render() {
            const list = document.getElementById('exercise-list');
            list.innerHTML = '';
            exercises.forEach(ex => {
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                        <div>
                            <span class="info-tag">${ex.prog}</span>
                            <div style="font-weight:bold; font-size:1.1rem; margin: 4px 0;">${ex.name}</div>
                            <div style="color:var(--accent); font-size:0.9rem;">${getProgression(ex)}</div>
                        </div>
                        <button onclick="deleteEx(${ex.id})" style="width:auto; background:none; color:#666; padding:0;">✕</button>
                    </div>

                    <div class="weight-input-group">
                        <input type="number" id="weight-${ex.id}" placeholder="Weight (lbs/kg)" inputmode="decimal">
                        <button onclick="logWeight(${ex.id})">Log Set</button>
                    </div>

                    <div class="history-section">
                        ${ex.logs.slice(0, 5).map(l => `
                            <div class="log-entry">
                                <span>Wk ${l.week} - ${l.date}</span>
                                <strong>${l.weight}</strong>
                            </div>
                        `).join('') || '<div style="font-size:10px; color:#555;">No logs yet</div>'}
                    </div>

                    <button onclick="nextWeek(${ex.id})" style="background:#333; color:white; margin-top:10px; font-size:12px;">Advance to Next Week</button>
                `;
                list.appendChild(div);
            });
        }

        function nextWeek(id) {
            const ex = exercises.find(e => e.id === id);
            ex.week++; save(); render();
        }

        function deleteEx(id) {
            if(confirm('Delete this exercise?')) {
                exercises = exercises.filter(e => e.id !== id);
                save(); render();
            }
        }

        function startTimer(sec) {
            clearInterval(timerInterval);
            let time = sec;
            const display = document.getElementById('timer-display');
            timerInterval = setInterval(() => {
                const m = Math.floor(time / 60);
                const s = time % 60;
                display.innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
                if (time-- <= 0) {
                    clearInterval(timerInterval);
                    display.innerText = "DONE";
                    if(navigator.vibrate) navigator.vibrate([300, 100, 300]);
                }
            }, 1000);
        }

        render();
    </script>
</body>
</html>
